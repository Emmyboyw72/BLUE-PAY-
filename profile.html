<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Profile â€¢ BluePay</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --blue-primary: #1a73e8;
      --blue-dark: #0d47a1;
      --blue-light: #e8f0fe;
      --white: #ffffff;
      --text-gray: #2d2d2d;
      --border-gray: #e0e6ed;
      --bg-light: #fafbff;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      background-color: var(--bg-light);
      color: var(--text-gray);
      min-height: 100vh;
      padding: 0;
      margin: 0;
      touch-action: manipulation;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: linear-gradient(120deg, var(--blue-primary), var(--blue-dark));
      color: white;
      padding: 16px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 800;
      font-size: 1.5rem;
      letter-spacing: -0.5px;
    }

    /* Three-dot menu */
    .menu-btn {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .menu-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Dropdown menu */
    .dropdown {
      position: absolute;
      top: 60px;
      right: 20px;
      background: var(--blue-primary);
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(26, 115, 232, 0.3);
      z-index: 200;
      overflow: hidden;
      display: none;
    }

    .dropdown-item {
      color: white;
      padding: 14px 24px;
      text-decoration: none;
      display: block;
      font-weight: 600;
      transition: background 0.2s;
    }

    .dropdown-item:hover {
      background: rgba(255,255,255,0.15);
    }

    /* Profile Container */
    .container {
      padding: 24px;
      max-width: 500px;
      margin: 0 auto;
    }

    .profile-card {
      background: white;
      border-radius: 24px;
      padding: 32px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      margin-bottom: 32px;
    }

    .avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--blue-primary), var(--blue-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      box-shadow: 0 6px 16px rgba(26, 115, 232, 0.25);
    }

    .avatar-icon {
      width: 60px;
      height: 60px;
      background: url("image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E") no-repeat center;
      background-size: contain;
    }

    .profile-name {
      font-family: 'Montserrat', sans-serif;
      font-weight: 800;
      font-size: 1.8rem;
      margin-bottom: 8px;
      color: var(--text-gray);
    }

    .profile-email {
      color: #5f6368;
      font-size: 1.1rem;
      margin-bottom: 24px;
      font-family: 'Inter', monospace;
    }

    .link-section {
      background: var(--blue-light);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .link-title {
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--blue-primary);
    }

    .custom-link {
      background: white;
      border: 1px solid var(--border-gray);
      border-radius: 12px;
      padding: 14px;
      font-size: 1.1rem;
      margin-bottom: 16px;
      word-break: break-all;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .copy-btn {
      background: linear-gradient(135deg, var(--blue-primary), var(--blue-dark));
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .copy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }

    /* Beautiful Alert Styles */
    .alert-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.55);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(6px);
    }

    .alert {
      background: white;
      border-radius: 24px;
      padding: 40px;
      width: 90%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(26, 115, 232, 0.15);
    }

    .alert h2 {
      color: var(--blue-primary);
      margin-bottom: 20px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 800;
      font-size: 1.7rem;
    }

    .alert p {
      margin-bottom: 28px;
      line-height: 1.6;
      color: #444;
      font-size: 1.05rem;
    }

    .alert-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .alert-button {
      background: linear-gradient(135deg, var(--blue-primary), var(--blue-dark));
      color: white;
      border: none;
      padding: 14px 32px;
      border-radius: 14px;
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .alert-button.secondary {
      background: #f1f3f4;
      color: #5f6368;
    }

    .alert-button:hover {
      transform: scale(1.03);
      box-shadow: 0 5px 15px rgba(26, 115, 232, 0.4);
    }

    .alert-button.secondary:hover {
      background: #e8eaed;
      transform: scale(1.03);
    }

    /* Loading Screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.96);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      backdrop-filter: blur(3px);
    }

    .loader {
      width: 44px;
      height: 44px;
      border: 4px solid rgba(26,115,232,0.2);
      border-top-color: var(--blue-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>My Profile</h1>
    <button class="menu-btn" id="menuBtn">â‹¯</button>
    
    <!-- Dropdown Menu -->
    <div class="dropdown" id="dropdownMenu">
      <a href="dashboard.html" class="dropdown-item">Dashboard</a>
      <a href="#" class="dropdown-item" id="logoutBtn">Logout</a>
    </div>
  </div>

  <div class="container">
    <div class="profile-card">
      <div class="avatar">
        <div class="avatar-icon" id="avatarIcon"></div>
      </div>
      <div class="profile-name" id="profileName">Loading...</div>
      <div class="profile-email" id="profileEmail">Loading...</div>
      
      <div class="link-section">
        <div class="link-title">Your BluePay Link</div>
        <div class="custom-link" id="customLink">Loading...</div>
        <button class="copy-btn" id="copyBtn">Copy Link</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore-compat.js"></script>

  <script>
    // ðŸ”‘ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCusJ_rFuOWwy1QFZedtyJr7igCeiIg3a0",
      authDomain: "my-sign-up-and-login.firebaseapp.com",
      projectId: "my-sign-up-and-login",
      storageBucket: "my-sign-up-and-login.firebasestorage.app",
      messagingSenderId: "1009128333653",
      appId: "1:1009128333653:web:15c1609ca3fbd4720c0fdc"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM Elements
    const profileName = document.getElementById('profileName');
    const profileEmail = document.getElementById('profileEmail');
    const customLink = document.getElementById('customLink');
    const copyBtn = document.getElementById('copyBtn');
    const menuBtn = document.getElementById('menuBtn');
    const dropdownMenu = document.getElementById('dropdownMenu');
    const logoutBtn = document.getElementById('logoutBtn');

    let currentUser = null;

    // Initialize
    function init() {
      // Check auth state
      auth.onAuthStateChanged(async (user) => {
        if (!user) {
          window.location.href = "login.html";
          return;
        }

        currentUser = user;
        await loadUserProfile();
      });

      // Menu toggle
      menuBtn.addEventListener('click', () => {
        dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!menuBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
          dropdownMenu.style.display = 'none';
        }
      });

      // Copy button
      copyBtn.addEventListener('click', copyLink);

      // Logout
      logoutBtn.addEventListener('click', showLogoutConfirmation);
    }

    // Load user profile
    async function loadUserProfile() {
      try {
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        if (userDoc.exists) {
          const userData = userDoc.data();
          
          // Set profile name (use username or email prefix)
          const displayName = userData.name || currentUser.email.split('@')[0];
          profileName.textContent = displayName;
          
          // Set email
          profileEmail.textContent = currentUser.email;
          
          // Generate custom link
          const customUrl = `https://${displayName.toLowerCase().replace(/\s+/g, '')}.com`;
          customLink.textContent = customUrl;
          
          // Set avatar based on gender (simulated)
          // In a real app, you'd store gender in user data
          const isFemale = Math.random() > 0.5; // Random for demo
          const avatarIcon = document.getElementById('avatarIcon');
          avatarIcon.style.background = isFemale 
            ? "url('image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27%3E%3Cpath fill=%27%23ffffff%27 d=%27M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z%27/%3E%3C/svg%3E') no-repeat center"
            : "url('image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27%3E%3Cpath fill=%27%23ffffff%27 d=%27M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z%27/%3E%3C/svg%3E') no-repeat center";
        } else {
          // Fallback if no user data
          profileName.textContent = currentUser.email.split('@')[0];
          profileEmail.textContent = currentUser.email;
          customLink.textContent = `https://${currentUser.email.split('@')[0].toLowerCase()}.com`;
        }
      } catch (error) {
        console.error("Error loading profile:", error);
        showBeautifulAlert("Error", "Failed to load profile. Please try again.");
      }
    }

    // Copy link to clipboard
    async function copyLink() {
      const link = customLink.textContent;
      try {
        await navigator.clipboard.writeText(link);
        showBeautifulAlert("Success", "Link copied to clipboard!", "OK");
      } catch (error) {
        console.error("Copy failed:", error);
        showBeautifulAlert("Error", "Failed to copy link. Please try again.");
      }
    }

    // Show logout confirmation
    function showLogoutConfirmation() {
      dropdownMenu.style.display = 'none';
      showBeautifulAlert(
        "Logout Confirmation",
        "Are you sure you want to logout of this account?",
        "Cancel",
        "Yes, Logout",
        () => {
          // Do nothing on cancel
        },
        async () => {
          try {
            await auth.signOut();
            window.location.href = "login.html";
          } catch (error) {
            console.error("Logout failed:", error);
            showBeautifulAlert("Error", "Failed to logout. Please try again.");
          }
        }
      );
    }

    // Beautiful Alert Function (with two buttons)
    function showBeautifulAlert(title, message, cancelText = "Cancel", confirmText = "OK", cancelCallback = null, confirmCallback = null) {
      const overlay = document.createElement('div');
      overlay.className = 'alert-overlay';
      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert';
      
      if (cancelCallback && confirmCallback) {
        // Two-button alert (for confirmation)
        alertDiv.innerHTML = `
          <h2>${title}</h2>
          <p>${message}</p>
          <div class="alert-buttons">
            <button class="alert-button secondary">${cancelText}</button>
            <button class="alert-button">${confirmText}</button>
          </div>
        `;
        
        const cancelBtn = alertDiv.querySelector('.secondary');
        const confirmBtn = alertDiv.querySelector('.alert-button:not(.secondary)');
        
        cancelBtn.addEventListener('click', () => {
          document.body.removeChild(overlay);
          if (cancelCallback) cancelCallback();
        });
        
        confirmBtn.addEventListener('click', () => {
          document.body.removeChild(overlay);
          if (confirmCallback) confirmCallback();
        });
      } else {
        // Single-button alert
        alertDiv.innerHTML = `
          <h2>${title}</h2>
          <p>${message}</p>
          <button class="alert-button">${confirmText}</button>
        `;
        
        const button = alertDiv.querySelector('.alert-button');
        button.addEventListener('click', () => {
          document.body.removeChild(overlay);
          if (confirmCallback) confirmCallback();
        });
      }
      
      overlay.appendChild(alertDiv);
      document.body.appendChild(overlay);
      
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay && !cancelCallback) {
          document.body.removeChild(overlay);
          if (confirmCallback) confirmCallback();
        }
      });
    }

    // Initialize when page loads
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>